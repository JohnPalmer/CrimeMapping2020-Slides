# Aggregating Point Data

## Counting Points in Areal Units

### Obtain the data

For this exercise, we will again use the New York City assault data extracted from  <a href="https://data.cityofnewyork.us/">NYC Open Data</a>, which you can download by clicking the button below.

<a href="data/NYPD_Complaint_Map__Year_to_Date.csv">Download the data</a>

### Obtaining shapefile

We will use the polygons in the New York City police precinct geojson shapefile from the same site. You can download it using the button below. If the geojson text appears in a new browser window rather than automatically triggering a download prompt, simply choose <kbd>Save Page As...</kbd> or else copy the text and past it into a new text file, saving with the geojson extension.

<a href="data/PolicePrecincts.geojson" download="data/PolicePrecincts.geojson">Download geojson shapefile</a>

### Add the shapefile layer to your map

Add the shapefile to your map with <kbd>Layer &rarr; Add Layer &rarr; Add Vector Layer...</kbd>, or with the <span><img height="30px" src="images/r_add_vector_layer_button.png" alt="screenshot"></span> button.

Select the geojson file and click <kbd>Open</kbd>.

### Add the data

Add the data using <kbd>Layer &rarr; Add Layer &rarr; Add Delimited Text Layer...</kbd>, or the <span><img height="30px" src="images/r_add_csv_layer_button.png" alt="screenshot"></span> button.

Select the data file (for this exercise it is <samp>NYPD_Complaint_Map__Year_to_Date.csv</samp>). On the  <kbd>Geometry definition</kbd> line, make sure <kbd>Point coordinates</kbd> is selected and make sure the <samp>Longitude</samp> and <samp>Latitude</samp> fields are selected for the <kbd>X field</kbd> and <kbd>Y field</kbd>, respectively. Click <kbd>OK</kbd>.

In the <samp>Coordinate Reference System</samp> window that should now pop up, select the appropriate coordinate reference system. If the points are defined by Latitude and Longitude (as in our exercise data), then this should be WGS 84 (EPSG 4326). (If you are using data in another coordinate reference system, make sure you check which this is in the data documentation.)

### Count the points in each polygon

To count how many points (crime report locations) fall within each polygon (police precinct), use <kbd>Vector &rarr; Analysis Tools &rarr; Count points in polygon</kbd>.

In the parameters tab of the window that pops up make sure that the correct layers are selected for the polygons and the points, and click <kbd>Run</kbd>.

You will now see that a new layer has appeared on your map and inyour layers window. The new layer contains the polygons from your original polygon layer, but it also has an attribute table that links each of these polygons to the count of points that falls within it. The polygons will appear by default with one single fill color, but you can change the style to color them according the count. (For example, follow the [Mapping Aggregated Data](#mapping-aggregated-data) recipes.)
