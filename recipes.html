<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>Crime Mapping and Spatial Analysis</title>
  <meta name="description" content="Mètodes d'Investigació Criminològica Avançada">
  <meta name="author" content="John R.B. Palmer">

  <!-- Bootstrap -->
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->


      <!-- Bootstrap TOC -->
      <!-- add after bootstrap.min.css -->
      <link rel="stylesheet" href="https://cdn.rawgit.com/afeld/bootstrap-toc/v0.4.1/dist/bootstrap-toc.min.css">

      <link rel="stylesheet" href="css/recipes_style.css">

      <link href="https://fonts.googleapis.com/css?family=Anton" rel="stylesheet">
    </head>
    <body data-spy="scroll" data-target="#toc">


     <div class="jumbotron">
       <div class="container" style="text-align: center">
        <h1 data-toc-skip><b>Crime Mapping and Spatial Analysis</b></h2>
        <h3 data-toc-skip>QGIS Recipes</h3>
        
        <address>
          <strong><a href="http://johnrbpalmer.com">John Palmer</a></strong><br>
          Universitat Pompeu Fabra<br>
          2019 - 2nd Trimester<br>
        </address>
        
      </div>
    </div>

    <div class="container">
      <div class="row">
        <!-- sidebar, which will move to the top on a small screen -->
        <div class="col-sm-3">
          <nav id="toc" data-spy="affix" data-toggle="toc"></nav>
        </div>
        <!-- main content area -->
        <div class="col-sm-9">

        <h1>First Steps With QGIS</h1>

        <h2>Beginning a new project</h2>

        <p>In QGIS, "projects" are used to store the settings you are using. It is helpful to start a new project for each map or set of related maps that you are making. This way, you can return to your work later and start from where you left off. Note, however, that the project file does not store the data you are using or the maps you generate. These must be stored as separate files.</p>

        <p>To start a new project use the menu item <kbd>Project &rarr; New</kbd> or the <span><img height="30px" src="images/qgis_button_new.png" alt="screenshot"></span> button.</p>


        <h2>Changing the language</h2>

        <p>When you start QGIS it will normally be set to the default language of your computer's operating system. To change the language, use the menu item <kbd>Settings &rarr; Options</kbd> and select <kbd>Locale</kbd>. The check the box <kbd>Override system locale</kbd> and select the language you want. You will need to restart QGIS for the change to go into effect.</p>
<!--
            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Canviar l'idioma</h4>
                  <p>QGIS Versió 2.18.15 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/qgis_change_language.png">
                    <img src="images/qgis_change_language.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

-->
            <h2>Installing plugins</h2>

            <p>QGIS makes it easy for the QGIS development team as well as anyone else to write "plugins," which add particular features or functions to the program. Many of these are extremely useful.</p>

            <p>To install a plugin, use the menu item <kbd>Plugins &rarr; Manage and install plugins...</kbd>. This will bring up a window with a long list of available plugins on the QGIS official repository. (There are other plugin repositories that individual authors maintain but for now we will use only the official one.). Use the search bar or scroll down the list to find and install the OpenLayers plugin. (If it is already installed on your machine, you will see a check next to it and you do not need to do anything else. In the computer labs, even if you have installed a plugin during a previous session it may not remain on your machine in future sessions so it is a good idea to check that you have what you need before starting.</p>
<!--

            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Instal·lar connectors</h4>
                  <p>QGIS Versió 2.18.15 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/qgis_install_plugins.png">
                    <img src="images/qgis_install_plugins.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>
-->

            <h2>Using the OpenLayers plugin for map tiles</h2>

            <p>To quickly make use of existing map tiles, you can use the OpenLayers plugin. This will let you connect to various map tile servers, which will allow you to use QGIS much in the way you may have used Google Maps on a web browser.</p>

            <p>Select the menu item <kbd>Web &rarr; OpenLayers plugin &rarr; OpenStreetMap &rarr; OpenStreetMap</kbd>. (OpenStreetMap is just one of the possible map tile servers - try the others as well.) You will now see the OpenStreetMap tiles in your console. You can pan and zoom around the map (although, as you will see, this doing so it not as easy as it is on, say, Google Maps through a web browser). The easiest way to zoom-in on a particular location is to select the Zoom In tool (<kbd>View &rarr; Zoom In)</kbd>. Then use the mouse to draw a small box over the location you want. You will probably need to do this several times - and you may need to zoom out in the process if you end up in the wrong spot. Try zooming in our building.</p>


            <h2>Placing points on the map</h2>

            <p>The most straightforward (although least efficient) way to mark points on your map is to do it manually.</p>

            <p>To do this, you first need to create a new map layer ,using <kbd>Layer &rarr; Create layer &rarr; New Shapefile Layer</kbd> or the <span><img height="30px" src="images/qgis_button_new_layer.png" alt="screenshot"></span> button. In the window that pops up, you can choose to make this a layer of points, lines, or polygons. You can also modify the character encoding, the Coordinate Reference System, and the data fields that will be associated with this new layer. For now, keep the default values (which will produce a point layer), and click OK. You will then need to choose a directory and file name for this new layers.</p>


<!--
            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Crear una capa nova</h4>
                  <p>QGIS Versió 2.18.15 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/qgis_menu_new_layer.png">
                    <img src="images/qgis_menu_new_layer.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

   <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Crear una capa nova: Opcions</h4>
                  <p>QGIS Versió 2.18.15 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/qgis_menu_new_layer_options.png">
                    <img src="images/qgis_menu_new_layer_options.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

 <p>Selecciona un nom pel Shapefile nou i guarda-ho.</p>


   <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Crear una capa nova: guarda-ho</h4>
                  <p>QGIS Versió 2.18.15 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/qgis_new_layer_save.png">
                    <img src="images/qgis_new_layer_save.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

-->

 <p>In order to add a point, move the cursor over your new layer in the Layers Panel and right-click on it. Then select <kbd>Toggle Editing</kbd>.</p>

<!--
  <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Crear una capa nova: guarda-ho</h4>
                  <p>QGIS Versió 2.18.15 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/qgis_editing_mode.png">
                    <img src="images/qgis_editing_mode.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>
-->

 <p>Now select the menu item <kbd>Edit &rarr; Add Feature</kbd> or press the <span><img height="30px" src="images/qgis_add_feature_button.png" alt="screenshot"></span> button. Click on the map wherever you want to add a point. Place a point on th approximate location of our classroom. Each time you click, you will need to provide attributes for the fields you created when you created the layer. For now, since we used the defaults, we need only an id. Give this whatever value you want.</p>


        <h1 id="mapping_basics">Mapping Basics</h1>

          <h2>Mapping crime locations</h2>

          <h3>Obtaining Data</h3>

          <p>To get started, we will use data on reported assaults in New York City during November and December 2016. This has already been extracted from <a href="https://data.cityofnewyork.us/">NYC Open Data</a> and can be downloaded simply by clicking the button below. Save it to a location where you will be able to find it again.</p>

          <a class="btn btn-default" href="data/NYPD_Complaint_Map__Year_to_Date.csv" role="button">Download the Data</a>


            <h3>Adding data to your map</h3>

            <p>Add the data to your map using <kbd>Layer &rarr; Add Layer &rarr; Add Delimite Text Layer...</kbd>, or with the <span><img height="30px" src="images/r_add_csv_layer_button.png" alt="screenshot"></span> button.</p>

            <p>Select the data file you want (for this exercise, use the file you just downloaded and saved: <samp>NYPD_Complaint_Map__Year_to_Date.csv</samp>). In the <kbd>Geometry definition</kbd>box, make sure <kbd>Point coordinates</kbd> is selected. Make sure that the <kbd>X field</kbd> and <kbd>Y field</kbd> boxes contain the correct field names from your data for the x and y coordinates. You can check this by looking at the data preview shown in the bottom of the window. In this case, QGIS automatically recognizes that there are fields labeled Longitude and Latitude and that these should be x and y, respectively. Now click <kbd>OK</kbd>.</p>

                        <p>A new window will now pop up for you to select a Coordinate Reference System (CRS) for the layer you are adding. This will often require some thinking because selecting the wrong CRS will lead to your layer being incorrectly placed on the map (or sometimes not visible at all). For points recorded as Latitude and Longitude, you will want to use WGS 84 - EPSG 4326. (If you type 4326 in the filter bar at the top it will come up.) To view your new layer, you will probably need to pan and zoom to get to the location where it actually has data - in this case New York City. You can do that quickly by right-clicking on the layer in the Layers Panel and selecting <kbd>Zoom to Layer</kbd>. You may also need to make sure that the layer is not being covered by another layer. The order of the layers in the Layers Panel is the order in which they appear on the map (imagine actual layers of paper or transparent paper with features on a physical map). You can drag layers up and down in that list to change the order. To learn more about each point marked on the map, select <kbd>View &rarr; Identify Features</kbd> and click on a point. You will see information in the Identify Results panel on the right (although you may need to expand that panel to see the values associated with each feature.</p>


          <h2>Printing or Exporting a Map</h2>

<p>What you see in the QGIS console is useful for creating, modifying, and analyzing your map. If you want to share your map with someone or publish it as part of a report, you will want to use the print composer to produce high-quality output.</p>

<h3>Setting up the Print Composer</h3>

<p>Select <kbd>Project &rarr; New Print Composer</kbd>. In the dialog box that pops up, you can give this print composer a title or leave the box blank and click OK for the default title. You will now see a new window with a canvas that you can use to compose exactly how you want your map to look.</p>

  <h3>Adding a map</h3>

  <p>The most obvious thing you will want on your composed map is the map itself. Select <kbd>Layout &rarr; Add Map</kbd> and then use the mouse to draw a rectangle on the canvas where you want the map to appear. Notice that the map that will now appear in that box is essentially a mirror image of the map you currently have in the main console (although the dimensions may be different depending on how you draw the box). After drawing the box, you can still move it around using the <kbd>Layout &rarr; Move Item</kbd> tool, and you can move the map around within it using the <kbd>Layout &rarr; Move Content</kbd> tool. Notice that you can add more than one map to your canvas. This makes it possible to include inset maps, for example, showing where your detailed map lies at a larger scale.</p>

  <h3>Adding a scale bar</h3>

<p>You may wish to add a scale bar to your map, and you can do this easily using <kbd>Layout &rarr; Add Scalebar</kbd>. Again, you will need to click on the map to position and resize the scale bar. You will notice that you also have many options to choose from in changing its appearance using the Item properties tab on the right.</p>

<h3>Adding a legend</h3>

<p>To add a legend, select <kbd>Layout &rarr; Add Legend</kbd> and use the mouse to draw a rectangle where you want the legend to appear. The legend will be automatically filled with the information in your layers list, but you can modify this using the Item properties tab on the right. Select the legend you have added and scroll down the Item properties to the <kbd>Legend Items</kbd> section. Uncheck <kbd>Auto update</kbd>. Now select the layers you do not wish to see in the legend and click the minus sign at the bottom to remove them. Next click the item(s) that you want in the legend and use the editing button to edit the text that will appear. In the <kbd>Main properties</kbd> section you can also change the title and alignment of the legend text.</p>

<h3>Exporting your map</h3>

<p>When you are happy with your map, use <kbd>Composer &rarr; Export as Image...</kbd> or <kbd>Composer &rarr; Export as PDF...</kbd> to export your map to a single file, which you can then share, embed in a report, or print.</p>


<h1 id="creating_polygons">Creating Vector Data From Raster Base</h1>

<p>It will often be necessary to create vector data -- points, lines, or polygons -- by tracing features on an existing raster map. This recipe will walk you through that process.</p>

<h2 id="add_raster">Adding a raster</h2>
<p>Start a new project and add a raster layer. For this exercise, use a high resolution orthophoto, such as those available at <a href="http://www.icc.cat/appdownloads/index.html">http://www.icc.cat/appdownloads/index.html</a>. By saving the file in GeoTiff format you will ensure that it includes projection (CRS) information that QGIS can read automatically. Add the layer using <kbd>Layer  &rarr; Add Layer  &rarr; Add Raster Layer...</kbd> and then selecting the file. (If the file itself does not contain projection information, you will need to supply this.)</p>

<h2 id="create_new_vector_layer">Creating a new vector layer.</h2>
<p>Create a new vector layer using <kbd>Layer &rarr; Create Layer &rarr; New Shapefile Layer...</kbd>. In the dialog box that comes up, you can select the type of layer, character encoding, CRS, and the data fields to associate with the new layer. For this exercise, choose <kbd>Polygon</kbd> as the type, and add at least one new field in which you will store information associated with each feature that you draw. For this exercise, we will be using the layer to indicate the approximate number of people on each block surrounding a building, so create a <kbd>Whole Number</kbd> field and give it a name (e.g. N). Save the new layer as an SHP file in a directory where you will be able to find it again.</p>                                                                                  
<h2 id="adding_features">Adding features</h2>
<p>The new layer you have added should appear in the <kbd>Layers Panel</kbd>. Right click on this new layer and hit <kbd>Toggle Editing</kbd>. You will now see a set of new buttons and available menu items. Select <kbd>Edit &rarr; Add Feature</kbd>. When you hover the mouse pointer over the map you will see that it now has the shape of a cross-hairs. Left click to add sequential points that define the polygon you want to add. When you have added the last point, right click the mouse and a dialog box will appear asking you to add the fields associated with this new feature. Remember that what you add will be limited by the field type you chose (and the ID field requires whole numbers by default). For this exercise, draw a rectangle over each of the sidewalks surrounding the building (so four separate features).</p>

<h1 id="vector_style">Adjusting Vector Layer Appearance</h1>

<p>QGIS gives you control over how your vector layers appear: You can adjust color, fill style, transparency, labeling, and many other characteristics.</p>

<h2>Opening the properties window</h2>
<p>To do this, you need to start by opening the <kbd>Layer Properties</kbd> window. Right click on the layer you want to adjust and select <kbd>Properties</kbd>. You will see a new window with a set of tabs on the left.</p>

<h2>Changing the color</h2>

<p>To change the layer's color, select the <kbd>Style</kbd> tab. If this is a polygon layer, you will see a box with <kbd>Fill</kbd> and under this <kbd>Simple fill</kbd>. Click on <kbd>Simple fill</kbd> and then use the scroll bar on the right side of the window to scroll down until you see the <kbd>Fill</kbd>, <kbd>Outline</kbd>, and <kbd>Fill style</kbd> selectors. Click the <kbd>Fill</kbd> selector and choose a color. Notice that you have different options for picking the color, including choosing one from a pallet or gradient, entering HSV or RGB values, or entering an HTML code. You can also choose the level of opacity, which lets you make semitransparent features. (Note that this can be set for the fill color itself or for the entire layer.)</p>

<h2>Changing the border and fill style</h2>

<p>You can also change the border and fill style using the <kbd>Outline</kbd> and <kbd>Fill style</kbd> selectors.</p>

<h2 id="labels">Adding labels</h2>

<p>To add labels to your layer, select the <kbd>Labels</kbd> tab. At the very top of the window, change the selector from <kbd>No labels</kbd> to <kbd>Show labels for this layer</kbd>. Just underneath this selector, you will see a selector for <kbd>Label with</kbd>. Use this to select the field you wish to use for your labels. If you created a field in the exercise above for number of people, you can use this to automatically display this information on each feature. Alternatively, you might have a field for name or ID. The idea here is that QGIS can automatically use one of the fields to generate labels. Try making labels and click <kbd>OK</kbd> to see how they look. Then return to the <kbd>Properties</kbd> window to explore the various options you have for adjusting the labels' appearance.</p>

<h1 id="osm_vectors">Adding OpenStreetMap vectors</h1>

<p>One useful way to add existing vector information to a map, while also making it possible to customize its appearance, is to download data from OpenStreetMap (OSM). The process will be to download the OSM file for a given area, then open it, choose the layers that you want, filter these layers according to feature type, and then modify appearances.</p>

<h2>Downloading OSM data</h2>

<p>Start with some raster base map that lets you navigate to a place of interest (OSM map tiles, an orthophoto etc.). Zoom in to a small area, such as a neighborhood or several city blocks. Now select <kbd>Vector &rarr; OpenStreetMap &rarr; Download Data...</kbd>. In the window that appears, select <kbd>From map canvas</kbd> for the extent. (This is a simple way of defining the boundaries of the data you will download. Note that selecting large boundaries will result in very large file sizes.) Now click the <kbd>...</kbd> button next to <kbd>Output file</kbd> and select a file name and destination directory to which you will save the downloaded information.</p>

<h2>Opening the OSM file and selecting layers</h2>

<p>To add the OSM data you just downloaded, select <kbd>Layer &rarr; Add Layer &rarr; Add Vector Layer...</kbd>. Browse to the OSM file you just downloaded and select <kbd>OK</kbd> then <kbd>Open</kbd> to open it. You will now see a new window with a list of layers that this file contains. You can select some or all of these. When you hit <knd>OK</knd> you will see each of these layers appear on your map and in your <kbd>Layers Panel</kbd>. For the rest of this exercise, focus just on the lines layer.</p>

<h2>Labeling the vector data</h2>

<p>You can add labels to this new layer just as you did above. You may find, however, that there is too much information and that you want to filter it somehow. You can filter the labels themselves using the labels tab. Or you can filter the features in the layer as follows:</p>

<h2>Filtering the vector data</h2>

<p>To filter a layer, open the <kbd>Properties</kbd> window (right click the layer and select this) and go to the <kbd>General</kbd> tab. Scroll down and you will see a <kbd>Provider feature filter</kbd> box. Click on the <kbd>Query Builder</kbd> button just below this box on the right. This will bring up a new window in which you can write a query to filter the features in this layer according to their attribute fields. To do this, you need to know something about what these fields contain, and you can see this by clicking on a field and hitting the <kbd>Sample</kbd> button. You can then create a filter by double clicking on a field name, clicking an operator, and then double clicking a value. You will see the query being built as you do this in the box at the bottom. For example <kbd>"highway"='tertiary'</kbd> would filter the features to include only those for which the "highway" field has the value (character string in this case) 'tertiary'.</p>

<p>Another way of filtering, which is often easier, is to start by coloring the features according to some field of interest. In the <kbd>Style</kbd> tab, select <kbd>Categorized</kbd> in the selector at the top. Then choose the field you want to use for this in the <kbd>Column</kbd> selector. Hit the <kbd>Classify</kbd> button and QGIS will assign a different random color to each different value that appears in this field. Click <kbd>OK</kbd> to see how this looks on the map. You can now click the field in the <kbd>Layers Panel</kbd> to expand it to show each unique value and the color assigned to it. You can click any of these to remove or return it to the map.</p>

<!--
            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Selecció d'arxius</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/add_point_data.png">
                    <img src="images/add_point_data.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>
-->


<!--
            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Selecció del sistema de referència de coordinades</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/add_point_data_proj.png">
                    <img src="images/add_point_data_proj.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>


            <p>El teu finestre hauria de d'aparèixer això (més o menys):</p>


    <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Dades de punts i polígons afegit</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/qgis_nyc_assault_points_only.png">
                    <img src="images/qgis_nyc_assault_points_only.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

<p>Tens ubicacions de assalts però res més. Pots obtenir informació sobre cada assalt utilitzant la eina <kbd>Visualització &rarr; Identifica els objectes</kbd> (el boton span><img height="30px" src="images/qgis_info_button.png" alt="screenshot"></span>.)</p>

   <h3>Afegeix un mapa</h3>

   <p>Instal·la el "OpenLayers Plugin" si ja no tens.</p>

   <p>Afegeix Google Maps imatges amb <kbd>Lloc web &rarr; Google Maps &rarr; Google Satellite</kbd>. Els punts de assalts despareixen perque estan sota els imatges del Google Maps.</p>

   <p>Reordena les capes del mapa arrossegant la capa "Google Satellite" per sota la capa "NYPD_Complaint_Map__Year_to_Date" en la subfinestra de capes.</p>

   <p>Canviar el estil dels marcadors de la capa "NYPD_Complaint_Map__Year_to_Date" per fer-els més visibles: Fes doble clic a la capa i selecciona <kbd>Estil</kbd>.</p>

   <h3>Afegeix dades vectorials</h3>

   <p>Zoom a una àrea que trobas interessant.</p>

<p>Afegeix dades de Open Street Maps amb <kbd>Vectorial &rarr; OpenStreetMap &rarr; Baixa dades...</kbd>. Per "Extensió" selecciona "Des de la vista del mapa." Per "Fitxer de sortida", selecciona un lloc on pots guardar les dades.  Despres de guardar-les, hauras de afegir amb <kbd>Capa &rarr; Afeigeix una capa &rarr;  Afeigeix una capa vectorial...</kbd></p>

-->
        <h1 id="mapping_aggregated_data">Mapping Aggregated Data</h1>

          <h2>Choropleth Maps</h2>

          <h3>Downloading data</h3>

          <p>For this exercise, we will use 2013 data extracted from the Eurostat database <i><a href="http://appsso.eurostat.ec.europa.eu/nui/show.do?query=BOOKMARK_DS-559176_QID_-2189685_UID_-3F171EB0&layout=ICCS,L,X,0;GEO,C,Y,0;UNIT,L,Z,0;TIME,C,Z,1;INDICATORS,C,Z,2;&zSelection=DS-559176TIME,2013;DS-559176INDICATORS,OBS_FLAG;DS-559176UNIT,NR;&rankName1=UNIT_1_2_-1_2&rankName2=INDICATORS_1_2_-1_2&rankName3=TIME_1_0_1_0&rankName4=ICCS_1_2_0_0&rankName5=GEO_1_2_0_1&rStp=&cStp=&rDCh=&cDCh=&rDM=true&cDM=true&footnes=false&empty=false&wai=false&time_mode=NONE&time_most_recent=false&lang=EN&cfo=%23%23%23%2C%23%23%23.%23%23%23">Recorded offences by offence category - police data</a></i>. (This data has been cleaned sightly after extraction to make things faster.)</p>

          <a class="btn btn-default" href="data/crim_off_cat_rates.csv" role="button">Download Data</a>

          <h3>Download Shapefiles</h3>
          <p>We will map this data using the <a href="http://ec.europa.eu/eurostat/web/gisco/geodata/reference-data/administrative-units-statistical-units/countries">Eurostat Countries 2013</a> shapefiles at the 1:3 million scale.</p>

          <a class="btn btn-default" href="http://ec.europa.eu/eurostat/cache/GISCO/geodatafiles/CNTR-03M-2013-SH.zip" role="button">Download Shapefiles</a>

          <h3>Unzip the Shapefiles</h3>

          <p>The file you downloaded is a zipped archive of shapefiles. Find the directory in which you saved it and double click on the file to unzip it.</p>

          <h3>Add Country Boundaries to Map</h3>

          <p>Add the country boundaries using <kbd>Layer &rarr; Add Layer &rarr; Add Vector Layer</kbd>, or with the <span><img height="30px" src="images/r_add_vector_layer_button.png" alt="screenshot"></span> button.</p>
<!--

          <div class="well">
            <div class="media">
              <div class="media-body">
                <h4 class="media-heading">Menús principals</h4>
                <p>QGIS Versió 2.18.2 per Mac</p>
              </div>
              <div class="media-right">
                <a href="images/r_add_vector_layer_1.png">
                  <img src="images/r_add_vector_layer_1.png" class="media-object" style="max-width:700px">
                </a>
              </div>
            </div>
          </div>
          <p>Hem de seleccionar els arxius de formes.</p>

          <div class="well">
            <div class="media">
              <div class="media-body">
                <h4 class="media-heading">Selecció d'arxius</h4>
                <p>QGIS Versió 2.18.2 per Mac</p>
              </div>
              <div class="media-right">
                <a href="images/r_add_vector_layer_2.png">
                  <img src="images/r_add_vector_layer_2.png" class="media-object" style="max-width:700px">
                </a>
              </div>
            </div>
          </div>
-->
          <p>In the add vector layer window that pops up, leave <kbd>Source type</kbd> as it is (the default is File with System encoding), and click the <kbd>Browse</kbd> button in the <kbd>Source</kbd> section to select the shapefiles you want to add. Navigate to the directory in which you unzipped these files look at what you have. You will see a number of sets of files with identical names. Each set represents a different layer. We will be using CNTR_RG_03M_2013, but go ahead and add all of them just to see what they look like. To do this, sort the files by type and then hold down the <kbd>Shift</kbd> key will clicking on all of the files that have the <samp>.shp</samp> extension. (QGIS will automatically open all associated files, which have the same names but different extensions).
<!--
            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Selecció d'arxius</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/r_add_vector_layer_file_selection.png">
                    <img src="images/r_add_vector_layer_file_selection.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>
-->
            <p>After selecting the files, click "Open" in the two dialog windows, and the shapes should appear on the map. (Remember that the order of the layers in the layer panel controls the order on the map and that you may need to change this to view certain layers.)</p>


            <h3>Adding the data</h3>

            <p>Add the data using <kbd>Layer &rarr; Add Layer &rarr; Add Delimited Text Layer...</kbd>, or with the <span><img height="30px" src="images/r_add_csv_layer_button.png" alt="screenshot"></span> button.</p>

<!--
            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Menús principals</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/r_add_csv_layer_1.png">
                    <img src="images/r_add_csv_layer_1.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>
-->
            <p>In the <kbd>File Name</kbd> box, select the data file (for this exercise, it is <samp>crim_off_cat_rates.csv</samp> if you did not change the name when saving it). In the <kbd>File format</kbd> box, choose <samp>CSV</samp> if it is not already chosen. Look in the preview area below and see if the data is appearing in an organized way, with column headings and values. (It should be for this exercise, but if you use a different data set in the future and it is not appearing correctly, the first thing to try is selecting the <kbd>Custom delimiters</kbd> option for <kbd>File format</kbd> and trying the <samp>Semicolon</samp> option or something else.) For <kbd>Geometry definition</kbd>, select <samp>No geometry (attribute only table)</samp>. This data source does not have coordinates. It simply has data by country name and you will need to link those country names to your shapes in the following step. Click <kbd>OK</kbd>.</p>
<!--
            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Selecció d'arxius</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/r_add_csv_layer_2.png">
                    <img src="images/r_add_csv_layer_2.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

            <p>El teu subfinestre de capes hauria de d'aparèixer això (més o menys):</p>

            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Subfinestre de capes</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/r_choro_layer_panel_1.png">
                    <img src="images/r_choro_layer_panel_1.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

-->
            <h3>Join the country polygons with the data.</h3>

            <p>In the layers panel, right click on the country boundary layer (which will be called <samp>CNTR_RG_03M_2013</samp> if you have not changed the names) and select <kbd>Properties</kbd>. In the properties window, select the <kbd>Joins</kbd> tab.
<!--

             <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Finestre de propietats de la capa</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/r_choro_props.png">
                    <img src="images/r_choro_props.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

-->
            <p>To join the data to the polygons, there needs to be a field in the data table that contains a set of unique identifiers corresponding to a set of the same unique identifiers in the polygon attribute table. For this exercise, the <samp>GEO</samp> field in the data table has country codes that correspond to the same country codes in the polygon attribute table's <samp>CNTR_ID</samp> field. (When you are using your own data sources, this will often require some initial cleaning. For example, you may need to convert country codes to make sure they match, or you may need to deal with complications like states, like Yugoslavia, that have broken apart or those, like Germany, that have formed through unification.)</p>  

            <p>Click the <span><img height="30px" src="images/r_choro_props_plus.png" alt="screenshot"></span> button. For <kbd>Join layer</kbd>, select your data you want to join (for this exercise it is <samp>crim_off_cat_rates</samp>). For <kbd>Join field</kbd>, select the field in the data table that you will be using for this join. In this case, <samp>GEO</samp>. For the <kbd>Target field</kbd>, select the field in the polygon attribute table that you will be using for the join. In this case, <samp>CNTR_ID</samp>). Click <kbd>OK</kbd> and then <kbd>Apply</kbd>.</p>
<!--
            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Especificar els camps</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/r_choro_props_union_add.png">
                    <img src="images/r_choro_props_union_add.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

            <p>Fes clic en <kbd>OK</kbd> i <kbd>Apply</kbd>.
-->
              <h3>Color the polygons according to crime data</h3>

              <p>In the <kbd>Style</kbd> panel, choose <kbd>Graduated</kbd> in the selector at the very top. Now select for <kbd>Column</kbd> the field you want to represent on the map. Since you have joined the data with this polygon layer, you will be able to choose from the fields in the data table as well as in your polygon attribute table. For this exercise, choose <samp>crim_off_cat_rates_Theft</samp>). Select a <kbd>Color ramp</kbd> that you like. Under the <kbd>Classes</kbd> tab, select a choice for <kbd>Mode</kbd>. You can experiment with different options and see how they appear. Now click the <kbd>Classify</kbd> button and then click <kbd>OK</kbd>.</p>

<!--
              <div class="well">
                <div class="media">
                  <div class="media-body">
                    <h4 class="media-heading">Estil dels polígons</h4>
                    <p>QGIS Versió 2.18.2 per Mac</p>
                  </div>
                  <div class="media-right">
                    <a href="images/r_choro_style.png">
                      <img src="images/r_choro_style.png" class="media-object" style="max-width:700px">
                    </a>
                  </div>
                </div>
              </div>

-->

              <h3>Clean the map</h3>


              <p>Use the layers panel to remove any unnecessary layers that are distracting (for instance, if you included all of the shape files in the Eurostat country data). Use the zoom and pan tools to focus the map on the area of interest to you.</p>

<!--

              <div class="well">
                <div class="media">
                  <div class="media-body">
                    <h4 class="media-heading">Mapa final</h4>
                    <p>QGIS Versió 2.18.2 per Mac</p>
                  </div>
                  <div class="media-right">
                    <a href="images/r_choro_final.png">
                      <img src="images/r_choro_final.png" class="media-object" style="max-width:700px">
                    </a>
                  </div>
                </div>
              </div>
-->
              <h2>Proportional Symbols</h2>

              <p>The choropleth map you just produced represents quantitative data using colors. But it is limited to showing one field from your data. What if you want to show additional information? One option would be to add a symbol on top of each color, making the size proportional to the additional values you want to display. In other words, one field will be displayed by color and another by size.</p>

              <p>If you added all of the shapefiles that you downloaded in the last exercise, then you already have everything you need. Put a check next to the <samp>CNTR_LB_2013</samp> layer in your layers panel to display a point for each country on top of the choropleth. You will use these points to place your proportional symbols. Right-click on this layer and select <kbd>Properties</kbd>. Use the same approach as in the last exercise to join this layer to your data table.</p>

<!--


      <h3>Obtingues dades</h3>

          <p>Per practicar, utilitzarem dades de 2013 que he extret de la base de dades d'Eurostat <i><a href="http://appsso.eurostat.ec.europa.eu/nui/show.do?query=BOOKMARK_DS-559176_QID_-2189685_UID_-3F171EB0&layout=ICCS,L,X,0;GEO,C,Y,0;UNIT,L,Z,0;TIME,C,Z,1;INDICATORS,C,Z,2;&zSelection=DS-559176TIME,2013;DS-559176INDICATORS,OBS_FLAG;DS-559176UNIT,NR;&rankName1=UNIT_1_2_-1_2&rankName2=INDICATORS_1_2_-1_2&rankName3=TIME_1_0_1_0&rankName4=ICCS_1_2_0_0&rankName5=GEO_1_2_0_1&rStp=&cStp=&rDCh=&cDCh=&rDM=true&cDM=true&footnes=false&empty=false&wai=false&time_mode=NONE&time_most_recent=false&lang=EN&cfo=%23%23%23%2C%23%23%23.%23%23%23">Recorded offences by offence category - police data</a></i>. (He netejat ells una mica per fer l'exercici més fàcil.)</p>

          <a class="btn btn-default" href="data/crim_off_cat_rates.csv" role="button">Descarregar les dades</a>

          <h3>Obtingues arxius de formes</h3>
          <p>Per practicar, utilitzarem <a href="http://ec.europa.eu/eurostat/web/gisco/geodata/reference-data/administrative-units-statistical-units/countries">Eurostat geodatafiles de països</a> en l'escala de 1:3 milions. No us oblidis de descomprimir l'arxiu despres de descarregar-lo.</p>

          <a class="btn btn-default" href="http://ec.europa.eu/eurostat/cache/GISCO/geodatafiles/CNTR-03M-2013-SH.zip" role="button">Descarregar els arxius de formes</a>

          <h3>Afegeix les formes</h3>

          <p>Afegim les formes amb <kbd>Capa &rarr; Afegeix una capa &rarr; Afegeix una capa vectorial</kbd>, o amb el boton <span><img height="30px" src="images/r_add_vector_layer_button.png" alt="screenshot"></span>.</p>

          <div class="well">
            <div class="media">
              <div class="media-body">
                <h4 class="media-heading">Menús principals</h4>
                <p>QGIS Versió 2.18.2 per Mac</p>
              </div>
              <div class="media-right">
                <a href="images/r_add_vector_layer_1.png">
                  <img src="images/r_add_vector_layer_1.png" class="media-object" style="max-width:700px">
                </a>
              </div>
            </div>
          </div>

          <p>Hem de seleccionar els arxius de formes.</p>

          <div class="well">
            <div class="media">
              <div class="media-body">
                <h4 class="media-heading">Selecció d'arxius</h4>
                <p>QGIS Versió 2.18.2 per Mac</p>
              </div>
              <div class="media-right">
                <a href="images/r_add_vector_layer_2.png">
                  <img src="images/r_add_vector_layer_2.png" class="media-object" style="max-width:700px">
                </a>
              </div>
            </div>
          </div>

          <p>Per afegir arxius de forma ESRI, hem de seleccionar els arxius amb l'extensió <samp>.shp</samp> (QGIS s'obre automàticament tots els arxius associats). Per ara no mes necesitem els arxius <samp>CNTR_2014_03M_SH/Data/CNTR_RG_03M_2014.shp</samp> i <samp>CNTR_2014_03M_SH/Data/CNTR_LB_03M_2014.shp</samp>, pero podem seleccionar tots els arxius <samp>.shp</samp>. La manera més facil és ordenar els arxius per tipus i aleshores utilitzar la tecla de majúscules per seleccionar tot acaba en <samp>.shp</samp>.

            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Selecció d'arxius</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/r_add_vector_layer_file_selection.png">
                    <img src="images/r_add_vector_layer_file_selection.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

            <p>Després de seleccionar els arxius i fer clic a "Open" en les dues finestres de diàleg, les formes apareixeran al llenç del mapa. Recorda que l'ordre de capes en el subfinestre de capes determina l'aparició en el llenç del mapa.</p>


            <h3>Afegeix les dades</h3>



            <p>Afegim les dades amb <kbd>Capa &rarr; Afegeix una capa &rarr; Afegeix una capa de text delimitada</kbd>, o amb el boton <span><img height="30px" src="images/r_add_csv_layer_button.png" alt="screenshot"></span>.</p>


            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Menús principals</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/r_add_csv_layer_1.png">
                    <img src="images/r_add_csv_layer_1.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

            <p>Selecciona el arxiu de dades (per aquesta demostració, això és <samp>crim_off_cat_rates.csv</samp>). En la linea <kbd>Definició de geometria</kbd>, selecciona <kbd>No hi ha cap geometria (només la taula d'atributs)</kbd> i fes clic a <kbd>OK</kbd>.</p>

            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Selecció d'arxius</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/r_add_csv_layer_2.png">
                    <img src="images/r_add_csv_layer_2.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

            <p>El teu subfinestre de capes hauria de d'aparèixer això (més o menys):</p>

            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Subfinestre de capes</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/r_choro_layer_panel_1.png">
                    <img src="images/r_choro_layer_panel_1.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>


            <h3>Uneix als punts centrals dels països a les dades.</h3>

            <p>En el subfinestre de capes, fes doble clic a la capa <samp>CNTR_LB_03M_2013</samp> per obrir els seus propietats (o fes clic dret a la i seleciona <kbd>Propietats</kbd>.) Seleciona el panel de <kbd>Unions</kbd>.


             <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Finestre de propietats de la capa</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/r_prop_props.png">
                    <img src="images/r_prop_props.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

            <p>Fes clic al boton <span><img height="30px" src="images/r_choro_props_plus.png" alt="screenshot"></span>. En el camp <kbd>Uneix la capa</kbd> selecciona la capa les dades (per aquesta demostració, <samp>crim_off_cat_rates</samp>); en <kbd>Uneix el cap</kbd> i <kbd>Camp objectiu</kbd> selecciona el camps de les dades i dels punts que coincideixen  (per aquesta demostració, <samp>GEO</samp> i <samp>CNTR_ID</samp>).</p>

            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Especificar els camps</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/r_choro_props_union_add.png">
                    <img src="images/r_choro_props_union_add.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

            <p>Fes clic en <kbd>OK</kbd> i <kbd>Apply</kbd>.


-->
              <h3>Style the point symbols using graduated sizes</h3>

              <p>In the <kbd>Style</kbd> panel, select <kbd>Graduated</kbd> at the top and choose the <kbd>Column</kbd> you want to represent here. For this exercise, choose <samp>crim_off_cat_rates_TOTAL</samp>. For <kbd>Method</kbd> now select <samp>Size</samp>. Choose a <kbd>Mode</kbd> and click <kbd>Classify</kbd>. You will need to play around with classification modes as well as minimum and maximum sizes to create symbols that are useful for explaining your data. Click <kbd>OK</kbd> to display the result on your map.</p>

<!--
              <div class="well">
                <div class="media">
                  <div class="media-body">
                    <h4 class="media-heading">Estil dels polígons</h4>
                    <p>QGIS Versió 2.18.2 per Mac</p>
                  </div>
                  <div class="media-right">
                    <a href="images/r_prop_style.png">
                      <img src="images/r_prop_style.png" class="media-object" style="max-width:700px">
                    </a>
                  </div>
                </div>
              </div>

              <h3>Neteja el mapa</h3>


              <p>Eliminar les capes innecessàries i ampliar l'àrea d'interès.</p>


              <div class="well">
                <div class="media">
                  <div class="media-body">
                    <h4 class="media-heading">Mapa final</h4>
                    <p>QGIS Versió 2.18.2 per Mac</p>
                  </div>
                  <div class="media-right">
                    <a href="images/r_prop_final.png">
                      <img src="images/r_prop_final.png" class="media-object" style="max-width:700px">
                    </a>
                  </div>
                </div>
              </div>


-->
              <h2>Pie Charts</h2>

<p>To include even more information on your map, you may want to include some small charts that are then placed on top of geographic features. for this exercise we will use pie charts.</p>

<p>Return to your point layer properties and now select the <kdb>Diagrams</kdb> tab. At the top, select <samp>Pie chart</samp>. For attributes, select all of the individual crime categories that you want to include. Be careful not to include overlapping information here. Use the plus button to move all of these to the <kbd>Assigned attributes</kbd> list. You can also size your pie charts proportionally to another variable using the <kbd>size</kbd> tab here.</p>

<!--
          <h3>Obtingues dades</h3>

          <p>Per practicar, utilitzarem dades de 2013 que he extret de la base de dades d'Eurostat <i><a href="http://appsso.eurostat.ec.europa.eu/nui/show.do?query=BOOKMARK_DS-559176_QID_-2189685_UID_-3F171EB0&layout=ICCS,L,X,0;GEO,C,Y,0;UNIT,L,Z,0;TIME,C,Z,1;INDICATORS,C,Z,2;&zSelection=DS-559176TIME,2013;DS-559176INDICATORS,OBS_FLAG;DS-559176UNIT,NR;&rankName1=UNIT_1_2_-1_2&rankName2=INDICATORS_1_2_-1_2&rankName3=TIME_1_0_1_0&rankName4=ICCS_1_2_0_0&rankName5=GEO_1_2_0_1&rStp=&cStp=&rDCh=&cDCh=&rDM=true&cDM=true&footnes=false&empty=false&wai=false&time_mode=NONE&time_most_recent=false&lang=EN&cfo=%23%23%23%2C%23%23%23.%23%23%23">Recorded offences by offence category - police data</a></i>. (He netejat ells una mica per fer l'exercici més fàcil.) No us oblidis de descomprimir l'arxiu despres de descarregar-lo.</p>

          <a class="btn btn-default" href="data/crim_off_cat.zip" role="button">Descarregar les dades</a>

          <h3>Obtingues arxius de formes</h3>
          <p>Per practicar, utilitzarem <a href="http://ec.europa.eu/eurostat/web/gisco/geodata/reference-data/administrative-units-statistical-units/countries">Eurostat geodatafiles de països</a> en l'escala de 1:3 milions. No us oblidis de descomprimir l'arxiu despres de descarregar-lo.</p>

          <a class="btn btn-default" href="http://ec.europa.eu/eurostat/cache/GISCO/geodatafiles/CNTR-03M-2013-SH.zip" role="button">Descarregar els arxius de formes</a>

          <h3>Afegeix les formes</h3>

          <p>Afegim les formes amb <kbd>Capa &rarr; Afegeix una capa &rarr; Afegeix una capa vectorial</kbd>, o amb el boton <span><img height="30px" src="images/r_add_vector_layer_button.png" alt="screenshot"></span>.</p>

          <div class="well">
            <div class="media">
              <div class="media-body">
                <h4 class="media-heading">Menús principals</h4>
                <p>QGIS Versió 2.18.2 per Mac</p>
              </div>
              <div class="media-right">
                <a href="images/r_add_vector_layer_1.png">
                  <img src="images/r_add_vector_layer_1.png" class="media-object" style="max-width:700px">
                </a>
              </div>
            </div>
          </div>

          <p>Hem de seleccionar els arxius de formes.</p>

          <div class="well">
            <div class="media">
              <div class="media-body">
                <h4 class="media-heading">Selecció d'arxius</h4>
                <p>QGIS Versió 2.18.2 per Mac</p>
              </div>
              <div class="media-right">
                <a href="images/r_add_vector_layer_2.png">
                  <img src="images/r_add_vector_layer_2.png" class="media-object" style="max-width:700px">
                </a>
              </div>
            </div>
          </div>

          <p>Per afegir arxius de forma ESRI, hem de seleccionar els arxius amb l'extensió <samp>.shp</samp> (QGIS s'obre automàticament tots els arxius associats). Per ara no mes necesitem els arxius <samp>CNTR_2014_03M_SH/Data/CNTR_RG_03M_2014.shp</samp>, pero podem seleccionar tots els arxius <samp>.shp</samp>. La manera més facil és ordenar els arxius per tipus i aleshores utilitzar la tecla de majúscules per seleccionar tot acaba en <samp>.shp</samp>.

            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Selecció d'arxius</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/r_add_vector_layer_file_selection.png">
                    <img src="images/r_add_vector_layer_file_selection.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

            <p>Després de seleccionar els arxius i fer clic a "Open" en les dues finestres de diàleg, les formes apareixeran al llenç del mapa. Recorda que l'ordre de capes en el subfinestre de capes determina l'aparició en el llenç del mapa.</p>


            <h3>Afegeix les dades</h3>

            <p>Afegim les dades amb <kbd>Capa &rarr; Afegeix una capa &rarr; Afegeix una capa de text delimitada</kbd>, o amb el boton <span><img height="30px" src="images/r_add_csv_layer_button.png" alt="screenshot"></span>.</p>


            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Menús principals</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/r_add_csv_layer_1.png">
                    <img src="images/r_add_csv_layer_1.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

            <p>Selecciona el arxiu de dades (per aquesta demostració, això és <samp>crim_off_cat_rates.csv</samp> i <samp>crim_off_cat_N.csv</samp> -- selecciona un i repeteix aquest pas amb l'altre). En la linea <kbd>Definició de geometria</kbd>, selecciona <kbd>No hi ha cap geometria (només la taula d'atributs)</kbd> i fes clic a <kbd>OK</kbd>.</p>

            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Selecció d'arxius</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/r_add_csv_layer_2.png">
                    <img src="images/r_add_csv_layer_2.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

            <p>El teu subfinestre de capes hauria de d'aparèixer això (més o menys):</p>

            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Subfinestre de capes</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/r_multi_layer_panel_1.png">
                    <img src="images/r_multi_layer_panel_1.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>


            <h3>Uneix als polígons dels països a les dades.</h3>

            <p>En el subfinestre de capes, fes doble clic a la capa <samp>CNTR_RG_03M_2013</samp> per obrir els seus propietats (o fes clic dret a la i seleciona <kbd>Propietats</kbd>.) Seleciona el panel de <kbd>Unions</kbd>.


             <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Finestre de propietats de la capa</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/r_choro_props.png">
                    <img src="images/r_choro_props.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

            <p>Fes clic al boton <span><img height="30px" src="images/r_choro_props_plus.png" alt="screenshot"></span>. En el camp <kbd>Uneix la capa</kbd> selecciona la capa les dades (per aquesta demostració, <samp>crim_off_cat_rates</samp> i <samp>crim_off_cat_N</samp>); en <kbd>Uneix el cap</kbd> i <kbd>Camp objectiu</kbd> selecciona el camps de les dades i dels polígons que coincideixen  (per aquesta demostració, <samp>GEO</samp> i <samp>CNTR_ID</samp>).</p>

            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Especificar els camps</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/r_choro_props_union_add.png">
                    <img src="images/r_choro_props_union_add.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

            <p>Fes clic en <kbd>OK</kbd> i repeteix amb el altre arxiu.

    <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Especificar els camps</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/r_choro_props_union_add.png">
                    <img src="images/r_multi_props_union_add_2.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

            <p>Fes clic en <kbd>OK</kbd> i <kbd>Apply</kbd>.

              <h3>Canvia l'estil dels polígons</h3>

              <p>En el panel <kbd>Estil</kbd>, seleciona l'estil <kbd>Graduat</kbd> i selecciona la <kbd>Columna</kbd> que vols representar al mapa (per aquesta demostració, <samp>crim_off_cat_rates_TOTAL</samp>). Selecciona el <kbd>Degredal</kbd> i <kbd>Mode</kbd> que t'agrada i fes clic al <kbd>Classifica</kbd>.</p>


              <div class="well">
                <div class="media">
                  <div class="media-body">
                    <h4 class="media-heading">Estil dels polígons</h4>
                    <p>QGIS Versió 2.18.2 per Mac</p>
                  </div>
                  <div class="media-right">
                    <a href="images/r_choro_style.png">
                      <img src="images/r_choro_style.png" class="media-object" style="max-width:700px">
                    </a>
                  </div>
                </div>
              </div>

              <p>En el panel <kbd>Diagrames</kbd>, seleciona <kbd>Gràfic circular</kbd>. Per <kbd>Atributs</kbd> selecciona els delictes que vols incluir en els diagrames.</p>

              <div class="well">
                <div class="media">
                  <div class="media-body">
                    <h4 class="media-heading">Estil dels polígons</h4>
                    <p>QGIS Versió 2.18.2 per Mac</p>
                  </div>
                  <div class="media-right">
                    <a href="images/r_multi_diagrams_1.png">
                      <img src="images/r_multi_diagrams_1.png" class="media-object" style="max-width:700px">
                    </a>
                  </div>
                </div>
              </div>

             <p>Fes clic al boton <span><img height="30px" src="images/r_choro_props_plus.png" alt="screenshot"></span> per assignar els atributs seleccionats.

      <div class="well">
                <div class="media">
                  <div class="media-body">
                    <h4 class="media-heading">Estil dels polígons</h4>
                    <p>QGIS Versió 2.18.2 per Mac</p>
                  </div>
                  <div class="media-right">
                    <a href="images/r_multi_diagrams_2.png">
                      <img src="images/r_multi_diagrams_2.png" class="media-object" style="max-width:700px">
                    </a>
                  </div>
                </div>
              </div>

              <p>En <kbd>Mida</kbd> selecciona <kbd>Mida a la escala</kbd> i l'atribut que vols utilitzar per aixo (per aquesta demostració, utilitzem <samp>crim_off_cat_N_TOTAL</samp>.) Fes clic al <kbd>Cerca</kbd> per a cerca el valor màxim.</p>


      <div class="well">
                <div class="media">
                  <div class="media-body">
                    <h4 class="media-heading">Estil dels polígons</h4>
                    <p>QGIS Versió 2.18.2 per Mac</p>
                  </div>
                  <div class="media-right">
                    <a href="images/r_multi_diagrams_size.png">
                      <img src="images/r_multi_diagrams_size.png" class="media-object" style="max-width:700px">
                    </a>
                  </div>
                </div>
              </div>

              <p>Fes clic a <kbd>OK</kbd> i mira el mapa. Si els diagrames son massa gran o massa petit, torna al propietats dels polígons i ajustar la mida. (Per aquesta demonstració he utilizat 30.)

              <h3>Neteja el mapa</h3>


              <p>Eliminar les capes innecessàries i ampliar l'àrea d'interès.</p>


              <div class="well">
                <div class="media">
                  <div class="media-body">
                    <h4 class="media-heading">Mapa final</h4>
                    <p>QGIS Versió 2.18.2 per Mac</p>
                  </div>
                  <div class="media-right">
                    <a href="images/r_multi_final.png">
                      <img src="images/r_multi_final.png" class="media-object" style="max-width:700px">
                    </a>
                  </div>
                </div>
              </div>

-->
        <h1>Aggregating Point Data</h1>

        <h2 id="points_in_polys">Counting Points in Areal Units</h2>

        <h3>Obtain the data</h3>

          <p>For this exercise, we will again use the New York City assault data extracted from  <a href="https://data.cityofnewyork.us/">NYC Open Data</a>, which you can download by clicking the button below.</p>

          <a class="btn btn-default" href="data/NYPD_Complaint_Map__Year_to_Date.csv" role="button">Download the data</a>

          <h3>Obtaining shapefile</h3>
          <p>We will use the polygons in the New York City police precinct geojson shapefile from the same site. You can download it using the button below. If the geojson text appears in a new browser window rather than automatically triggering a download prompt, simply choose <kbd>Save Page As...</kbd> or else copy the text and past it into a new text file, saving with the geojson extension.</p>

          <a class="btn btn-default" href="data/PolicePrecincts.geojson" download="data/PolicePrecincts.geojson" role="button">Download geojson shapefile</a>

          <h3>Add the shapefile layer to your map</h3>

          <p>Add the shapefile to your map with <kbd>Layer &rarr; Add Layer &rarr; Add Vector Layer...</kbd>, or with the <span><img height="30px" src="images/r_add_vector_layer_button.png" alt="screenshot"></span> button.</p>

<!--
          <div class="well">
            <div class="media">
              <div class="media-body">
                <h4 class="media-heading">Menús principals</h4>
                <p>QGIS Versió 2.18.2 per Mac</p>
              </div>
              <div class="media-right">
                <a href="images/r_add_vector_layer_1.png">
                  <img src="images/r_add_vector_layer_1.png" class="media-object" style="max-width:700px">
                </a>
              </div>
            </div>
          </div>
-->
          <p>Select the geojson file and click <kbd>Open</kbd>.

<!--
          <div class="well">
            <div class="media">
              <div class="media-body">
                <h4 class="media-heading">Selecció d'arxius</h4>
                <p>QGIS Versió 2.18.2 per Mac</p>
              </div>
              <div class="media-right">
                <a href="images/add_geojson_precincts.png">
                  <img src="images/add_geojson_precincts.png" class="media-object" style="max-width:700px">
                </a>
              </div>
            </div>
          </div>
-->

            <h3>Add the data</h3>

            <p>Add the data using <kbd>Layer &rarr; Add Layer &rarr; Add Delimited Text Layer...</kbd>, or the <span><img height="30px" src="images/r_add_csv_layer_button.png" alt="screenshot"></span> button.</p>

            <p>Select the data file (for this exercise it is <samp>NYPD_Complaint_Map__Year_to_Date.csv</samp>). On the  <kbd>Geometry definition</kbd> line, make sure <kbd>Point coordinates</kbd> is selected and make sure the <samp>Longitude</samp> and <samp>Latitude</samp> fields are selected for the <kbd>X field</kbd> and <kbd>Y field</kbd>, respectively. Click <kbd>OK</kbd>.</p>
<!--
            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Selecció d'arxius</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/add_point_data.png">
                    <img src="images/add_point_data.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>
-->
            <p>In the <samp>Coordinate Reference System</samp> window that should now pop up, select the appropriate coordinate reference system. If the points are defined by Latitude and Longitude (as in our exercise data), then this should be WGS 84 (EPSG 4326). (If you are using data in another coordinate reference system, make sure you check which this is in the data documentation.)</p>
<!--
            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Selecció del sistema de referència de coordinades</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/add_point_data_proj.png">
                    <img src="images/add_point_data_proj.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

            <p>El teu finestre hauria de d'aparèixer això (més o menys):</p>


    <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Dades de punts i polígons afegit</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/add_point_data_added.png">
                    <img src="images/add_point_data_added.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

-->

          <h3>Count the points in each polygon</h3>

 <p>To count how many points (crime report locations) fall within each polygon (police precinct), use <kbd>Vector &rarr; Analysis Tools &rarr; Count points in polygon</kbd>.</p>

<!--
    <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Comptar punts en polígons</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/count_points_polys.png">
                    <img src="images/count_points_polys.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

-->

 <p>In the parameters tab of the window that pops up make sure that the correct layers are selected for the polygons and the points, and click <kbd>Run</kbd>.</p>

<!--

    <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Comptar punts en polígons: paràmetres</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/count_points_polys_settings.png">
                    <img src="images/count_points_polys_settings.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>
-->
<p>You will now see that a new layer has appeared on your map and inyour layers window. The new layer contains the polygons from your original polygon layer, but it also has an attribute table that links each of these polygons to the count of points that falls within it. The polygons will appear by default with one single fill color, but you can change the style to color them according the count. (For example, follow the <a href="#mapping_aggregated_data">Mapping Aggregated Data</a> recipes.)</p>

<h1>Geocoding</h1>

<p>Geocoding is the process of converting addresses into geographic coordinates. We can do this in QGIS using the MMQGIS Plugin.</p> 

<h2>Install MMQGIS</h2>

<p>Install the MQGIS plugin using <kbd>Plugins &rarr; Manage and Install Plugins</kbd> and searching for <samp>mmqgis</samp>.</p>


<h2>Obtain CSV address file</h2>

<p>The addresses you want to geocode using MMQGIS need to be in a CSV file that includes fields for address, city, state (province), and country. You could create a file like this using Excel or you may have a file like this already from whatever data source you are working with. For this exercise, use the file here:</p>

  <a class="btn btn-default" href="data/guardia_urbana_bcn_addresses.csv" role="button">Download the address data</a>

<h2>Use the MMQGIS geocoding function</h2>

<p>To geocode these addresses, click <kbd>MMQGIS &rarr; Geocode &rarr; Geocode CSV with Google / Open Street Map</kbd>.</p>

<p>In the dialog window that pops up, choose the CSV file with your addresses and make sure the Address, City, State, and Country fields are selected correctly. If you choose to geocode with Google Maps, you may need to obtain an Google API key to avoid limits. The simpler alternative is to use the OpenStreetMap / Nominatum option. You will also need to specify file names for the output file (where the geolocations will be stored) as well as for a file that will store a list of addresses that could not be geocoded. This second part is important because you will need to find ways to locate these addresses (often by modifying the address text). When you have all of this specified, click <kbd>OK</kbd>.</p>

<p>If some or all of the addresses could be geocoded, you will see a new points layer appear on your map, containing the locations. Make sure to check the file of addresses that could not be geocoded as well, and figure out what went wrong with these. One common error is with the character encoding. Your csv file needs to be encoded as UTF-8.</p>



<!--
    <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Nova capa</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/count_points_done.png">
                    <img src="images/count_points_done.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>




        <h2>Comptant punts en una graella</h2>

        <h3>Obtingues dades</h3>

          <p>Per practicar, utilitzarem dades de assalts en Nova York en novembre i disembre 2016 que he extret de <a href="https://data.cityofnewyork.us/">NYC Open Data</a>.</p>

          <a class="btn btn-default" href="data/NYPD_Complaint_Map__Year_to_Date.csv" role="button">Descarregar les dades</a>

          <h3>Obtingues arxius de formes</h3>
          <p>Per practicar, utilitzarem un arxiu geojson amb polygons dels recintes del Departament de Policia de Nova York que he descargat de <a href="https://data.cityofnewyork.us/">NYC Open Data</a>.</p>

          <a class="btn btn-default" href="data/Police Precincts.geojson" role="button">Descarregar els arxius de formes</a>

          <h3>Afegeix les formes</h3>

          <p>Afegim les formes amb <kbd>Capa &rarr; Afegeix una capa &rarr; Afegeix una capa vectorial</kbd>, o amb el boton <span><img height="30px" src="images/r_add_vector_layer_button.png" alt="screenshot"></span>.</p>

          <div class="well">
            <div class="media">
              <div class="media-body">
                <h4 class="media-heading">Menús principals</h4>
                <p>QGIS Versió 2.18.2 per Mac</p>
              </div>
              <div class="media-right">
                <a href="images/r_add_vector_layer_1.png">
                  <img src="images/r_add_vector_layer_1.png" class="media-object" style="max-width:700px">
                </a>
              </div>
            </div>
          </div>

          <p>Selecciona el arxiu geojson i fes clic al <kbd>Open</kbd>.

          <div class="well">
            <div class="media">
              <div class="media-body">
                <h4 class="media-heading">Selecció d'arxius</h4>
                <p>QGIS Versió 2.18.2 per Mac</p>
              </div>
              <div class="media-right">
                <a href="images/add_geojson_precincts.png">
                  <img src="images/add_geojson_precincts.png" class="media-object" style="max-width:700px">
                </a>
              </div>
            </div>
          </div>


            <h3>Afegeix les dades</h3>

            <p>Afegim les dades amb <kbd>Capa &rarr; Afegeix una capa &rarr; Afegeix una capa de text delimitada</kbd>, o amb el boton <span><img height="30px" src="images/r_add_csv_layer_button.png" alt="screenshot"></span>.</p>

            <p>Selecciona el arxiu de dades (per aquesta demostració, això és <samp>NYPD_Complaint_Map__Year_to_Date.csv</samp>). En la linea <kbd>Definició de geometria</kbd>, selecciona <kbd>Coordenades del punt</kbd> i fes clic a <kbd>OK</kbd>.</p>

            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Selecció d'arxius</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/add_point_data.png">
                    <img src="images/add_point_data.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

            <p>Selecciona una sistema de referència de coordinades (SRC). Si els coordinades dels punts son latitud i longitud, el SRC correcte es WGS 84 (EPSG 4326) i normalment esta seleccionat per defecte. Si tens dades amb altres coordinades, haurias de mirar en la documentació de les dades per a buscar el SRC.</p>

            <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Selecció del sistema de referència de coordinades</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/add_point_data_proj.png">
                    <img src="images/add_point_data_proj.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>


            <p>El teu finestre hauria de d'aparèixer això (més o menys):</p>


    <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Dades de punts i polígons afegit</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/add_point_data_added.png">
                    <img src="images/add_point_data_added.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

            <h3>Fes una graella</h3>


 <p>Tenim diverses opcions per fer una graella. Utilitzarem <kbd>MMQGIS &rarr; Create &rarr; Create Grid Layer</kbd>.</p>

    <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Graella amb MMQGIS</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/mmqgisgrid.png">
                    <img src="images/mmqgisgrid.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>


<p>Podem seleccionar "Rectangles," "Diamonds" (diamants), o "Hexagons" (hexàgons). Per aquesta recepte, selecciona "Hexagons." Les opcions "X Spacing" i "Y Spacing" dona la possibilitat de controlar la mida dels hexàgons. Si seleccionas "Project Units" per la opció "Units" (unitats), les unitats dependran de la SRC del projecte. Si la SRC es "WGS 84 / EPSG: 4326", les unitats seran graus. Si canviem la SRC a una sistema de UTM, com "NAD83 / UTM Zone 18N / EPSG: 26918", les unitats seran en metres.

    <div class="well">
              <div class="media">
                <div class="media-body">
                  <h4 class="media-heading">Graella: Opcions</h4>
                  <p>QGIS Versió 2.18.2 per Mac</p>
                </div>
                <div class="media-right">
                  <a href="images/mmqgisgrid_options.png">
                    <img src="images/mmqgisgrid_options.png" class="media-object" style="max-width:700px">
                  </a>
                </div>
              </div>
            </div>

<p>Ara pots com punts en polígons com abans. Una complicaciò potser si has canviat la SRC del projecte i encara tens la capa dels punts en un altre SRC (com WGS 84 / EPSG: 4326). En aquest cas, guarda la capa dels punts com una altre arxiu amb la SRC igual com la SRC dels polígons. Quan tens els punts i els polígons amb SRC igual, compta els punts en els polígons amb <kbd>Vectorial &rarr; Analysis Tools &rarr; Compte als punts al polígon</kbd>.</p>

<--



            </div>
          </div>
        </div>


        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <!-- Include all compiled plugins (below), or include individual files as needed -->
        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

        <!-- Bootstrap TOC -->
        <!-- add after bootstrap.min.js -->
        <script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v0.4.1/dist/bootstrap-toc.min.js"></script>
      </body>
      </html>
